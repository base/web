import{u as Jt}from"./useIsMounted-oytDHuHo.js";import{u as zt}from"./useTheme-DG4jZ5Gt.js";import{ai as rt,aS as It,ad as Zt,bz as X,Z as C,c as E,a0 as I,a1 as jt,_ as Qt}from"./OnchainKitProvider-BMiQl1rP.js";import{u as Mt}from"./useOnchainKit-BS9QuBF4.js";import{r as u,j as l}from"./index-Dlxm52NL.js";import{u as Xt,a as Yt,g as At}from"./FundCardPaymentMethodSelectorToggle-Bf15ueU3.js";import{g as ts,a as ss,i as ot,S as Dt}from"./Spinner-DJZ1Iw6h.js";import{f as es,w as Ht,c as as,b as ns}from"./useIcon-C51nxPJS.js";import{u as rs}from"./useValue-BadCClMc.js";import{G as Y}from"./ConnectWallet-BZ56ys6q.js";import{h as os}from"./waitForTransactionReceipt-DqmUmnvq.js";import{u as kt}from"./useAccount-BLyN9GYK.js";import{u as is}from"./useWaitForTransactionReceipt-C_3LN241.js";import{a as Lt}from"./useChainId-d5iqIE3x.js";import{S as cs,E as us,T as ls}from"./errorSvg-CqKVj3B9.js";async function fs(t,e){const{id:s}=e;await t.request({method:"wallet_showCallsStatus",params:[s]})}async function ms(t,e){const{connector:s,id:a}=e,n=await ts(t,{connector:s});return fs(n,{id:a})}function ds(t){return{mutationFn(e){return ms(t,e)},mutationKey:["showCallsStatus"]}}function ps(t={}){const{mutation:e}=t,s=rt(t),a=ds(s),{mutate:n,mutateAsync:r,...o}=ss({...e,...a});return{...o,showCallsStatus:n,showCallsStatusAsync:r}}function hs({errorMessage:t,hasReceipt:e,isInProgress:s,transactionHash:a,transactionId:n}){const r=n||a;return e||t?!1:!!(s||r)}function ys({setLifecycleStatus:t,transactionId:e}){var s,a;try{const n=es({id:e,query:{refetchInterval:i=>{var c;return((c=i.state.data)==null?void 0:c.status)==="CONFIRMED"?!1:1e3},enabled:!!e}}),r=n.data,o=(a=(s=r==null?void 0:r.receipts)==null?void 0:s[0])==null?void 0:a.transactionHash;return{status:r==null?void 0:r.status,transactionHash:o}}catch(n){return t({statusName:"error",statusData:{code:"TmUCSh01",error:JSON.stringify(n),message:""}}),{status:"error",transactionHash:void 0}}}function bs({setLifecycleStatus:t,transactionHashList:e}){const s=Xt({mutation:{onError:i=>{const c=ot(i)?"Request denied.":Y;t({statusName:"error",statusData:{code:"TmUSCh01",error:i.message,message:c}})},onSuccess:i=>{t({statusName:"transactionLegacyExecuted",statusData:{transactionHashList:[...e,i]}})}}}),a=s.status,n=s.sendTransactionAsync,r=s.data,o=s.reset;return{status:a,sendCallAsync:n,data:r,reset:o}}function gs({setLifecycleStatus:t,setTransactionId:e}){const s=Yt({mutation:{onError:i=>{const c=ot(i)?"Request denied.":Y;t({statusName:"error",statusData:{code:"TmUSCSh01",error:i.message,message:c}})},onSuccess:i=>{e(i)}}}),a=s.status,n=s.sendCallsAsync,r=s.data,o=s.reset;return{status:a,sendCallsAsync:n,data:r,reset:o}}function Rt(t){return"abi"in t}const Ss=["address"];function _t(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,a)}return s}function Pt(t){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?arguments[e]:{};e%2?_t(Object(s),!0).forEach(function(a){Ts(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):_t(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Ts(t,e,s){return(e=Cs(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function Cs(t){var e=ws(t,"string");return typeof e=="symbol"?e:e+""}function ws(t,e){if(typeof t!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var a=s.call(t,e);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function xs(t,e){if(t==null)return{};var s,a,n=js(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(a=0;a<r.length;a++)s=r[a],e.indexOf(s)===-1&&{}.propertyIsEnumerable.call(t,s)&&(n[s]=t[s])}return n}function js(t,e){if(t==null)return{};var s={};for(var a in t)if({}.hasOwnProperty.call(t,a)){if(e.indexOf(a)!==-1)continue;s[a]=t[a]}return s}const _s=async({capabilities:t,sendCallsAsync:e,transactions:s})=>{if(!s)return;const a=s==null?void 0:s.map(n=>{if(Rt(n)){const r=n.address,o=xs(n,Ss);return Pt(Pt({},o),{},{to:r})}return n});await e({calls:a,capabilities:t})},Ps=async({config:t,sendCallAsync:e,transactions:s})=>{const a=s==null?void 0:s.map(n=>Rt(n)?{data:os({abi:n==null?void 0:n.abi,functionName:n==null?void 0:n.functionName,args:n==null?void 0:n.args}),to:n==null?void 0:n.address}:n);for(const n of a){const r=await e(n);r&&await Ht(t,{hash:r,confirmations:1})}},Ns=({capabilities:t,sendCallAsync:e,sendCallsAsync:s,walletCapabilities:a})=>{const n=rt();return u.useCallback(async r=>{var i;if(!r)return;const o=await Promise.resolve(r);(i=a[It.AtomicBatch])!=null&&i.supported?await _s({capabilities:t,sendCallsAsync:s,transactions:o}):await Ps({config:n,sendCallAsync:e,transactions:o})},[s,e,t,a,n])},Es=t=>{var e;return((e=t==null?void 0:t.paymasterService)==null?void 0:e.url)||null};function Nt(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),s.push.apply(s,a)}return s}function Is(t){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?arguments[e]:{};e%2?Nt(Object(s),!0).forEach(function(a){Ms(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Nt(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Ms(t,e,s){return(e=As(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function As(t){var e=Ds(t,"string");return typeof e=="symbol"?e:e+""}function Ds(t,e){if(typeof t!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var a=s.call(t,e);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function N(t,e){return Rs(t)||Ls(t,e)||ks(t,e)||Hs()}function Hs(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ks(t,e){if(t){if(typeof t=="string")return Et(t,e);var s={}.toString.call(t).slice(8,-1);return s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set"?Array.from(t):s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?Et(t,e):void 0}}function Et(t,e){(e==null||e>t.length)&&(e=t.length);for(var s=0,a=Array(e);s<e;s++)a[s]=t[s];return a}function Ls(t,e){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var a,n,r,o,i=[],c=!0,d=!1;try{if(r=(s=s.call(t)).next,e!==0)for(;!(c=(a=r.call(s)).done)&&(i.push(a.value),i.length!==e);c=!0);}catch(f){d=!0,n=f}finally{try{if(!c&&s.return!=null&&(o=s.return(),Object(o)!==o))return}finally{if(d)throw n}}return i}}function Rs(t){if(Array.isArray(t))return t}const vt={},$t=u.createContext(vt);function K(){const t=u.useContext($t);if(t===vt)throw new Error("useTransactionContext must be used within a Transaction component");return t}function vs({calls:t,capabilities:e,chainId:s,children:a,contracts:n,isSponsored:r,onError:o,onStatus:i,onSuccess:c,resetAfter:d}){const f=kt(),S=rt(),p=Mt(),w=p.config,L=w===void 0?{paymaster:void 0}:w,y=L.paymaster,x=u.useState(""),W=N(x,2),M=W[0],_=W[1],tt=u.useState(""),R=N(tt,2),A=R[0],st=R[1],B=u.useState(!1),v=N(B,2),$=v[0],D=v[1],G=u.useState({statusName:"init",statusData:null}),O=N(G,2),h=O[0],b=O[1],U=u.useState(""),q=N(U,2),J=q[0],H=q[1],z=u.useState(),g=N(z,2),T=g[0],Z=g[1],Ot=u.useState([]),it=N(Ot,2),F=it[0],ct=it[1],P=t||n,et=as({chainId:s}),Ft=ns(),ut=Ft.switchChainAsync;if(!n&&!t)throw new Error("Transaction: calls or contracts must be provided as a prop to the Transaction component.");if(t&&n)throw new Error("Transaction: Only one of contracts or calls can be provided as a prop to the Transaction component.");const at=gs({setLifecycleStatus:b,setTransactionId:H}),lt=at.status,Vt=at.sendCallsAsync,ft=at.reset,Q=bs({setLifecycleStatus:b,transactionHashList:F}),mt=Q.status,Kt=Q.sendCallAsync,dt=Q.data,pt=Q.reset,ht=u.useMemo(()=>{var m;return(m=et[It.AtomicBatch])!=null&&m.supported?lt:mt},[mt,lt,et]),yt=u.useMemo(()=>r&&y?Is({paymasterService:{url:y}},e):e,[r,y,e]),bt=Ns({capabilities:yt,sendCallAsync:Kt,sendCallsAsync:Vt,walletCapabilities:et}),gt=ys({setLifecycleStatus:b,transactionId:J}),St=gt.transactionHash,Wt=gt.status,Bt=is({hash:dt||St}),j=Bt.data,Gt=Zt(),Tt=Gt.sendAnalytics,k=u.useCallback((m,V)=>{Tt(m,V)},[Tt]);u.useEffect(()=>{_(""),h.statusName==="error"&&(_(h.statusData.message),st(h.statusData.code),o==null||o(h.statusData)),h.statusName==="transactionLegacyExecuted"&&ct(h.statusData.transactionHashList),h.statusName==="success"&&(c==null||c({transactionReceipts:h.statusData.transactionReceipts})),i==null||i(h)},[o,i,c,h,h.statusData,h.statusName]),u.useEffect(()=>{ht==="pending"&&b({statusName:"transactionPending",statusData:null})},[ht]),u.useEffect(()=>{if(j&&(b({statusName:"success",statusData:{transactionReceipts:[j]}}),d)){const m=setTimeout(()=>{_(""),st(""),D(!1),H(""),ct([]),Z(void 0),ft(),pt()},d);return()=>clearTimeout(m)}},[j,d,ft,pt]);const Ct=u.useCallback(async()=>{const m=[];for(const V of F)try{const nt=await Ht(S,{hash:V,chainId:s});m.push(nt)}catch(nt){b({statusName:"error",statusData:{code:"TmTPc01",error:JSON.stringify(nt),message:Y}})}b({statusName:"success",statusData:{transactionReceipts:m}})},[s,S,F]);u.useEffect(()=>{!P||F.length!==T||T<2||Ct()},[P,T,F,Ct]);const wt=u.useCallback(async m=>{m&&f.chainId!==m&&await ut({chainId:m})},[f.chainId,ut]),xt=u.useCallback(async()=>{b({statusName:"buildingTransaction",statusData:null});try{k(X.TransactionInitiated,{address:f.address});const m=await(typeof P=="function"?P():Promise.resolve(P));return Z(m==null?void 0:m.length),m}catch(m){k(X.TransactionFailure,{error:m.message,metadata:{code:A}}),b({statusName:"error",statusData:{code:"TmTPc04",error:JSON.stringify(m),message:"Error building transactions"}});return}},[P,k,f.address,A]),Ut=u.useCallback(async()=>{_(""),D(!0);try{await wt(s);const m=await xt();await bt(m)}catch(m){const V=ot(m)?"Request denied.":Y;b({statusName:"error",statusData:{code:"TmTPc03",error:JSON.stringify(m),message:V}})}},[xt,s,bt,wt]),qt=rs({chainId:s,errorCode:A,errorMessage:M,isLoading:Wt==="PENDING",isToastVisible:$,lifecycleStatus:h,onSubmit:Ut,paymasterUrl:Es(yt),receipt:j,setIsToastVisible:D,setLifecycleStatus:b,setTransactionId:H,transactions:P,transactionId:J,transactionHash:dt||St,transactionCount:T});return u.useEffect(()=>{j&&(j.status==="success"?k(X.TransactionSuccess,{paymaster:!!(r&&y),address:f.address,transactionHash:j.transactionHash}):k(X.TransactionFailure,{error:"Transaction failed",metadata:{code:A}}))},[j,k,r,y,f.address,A]),l.jsx($t.Provider,{value:qt,children:a})}function $s({className:t,disabled:e=!1,text:s="Transact",errorOverride:a,successOverride:n,pendingOverride:r}){var H,z;const o=K(),i=o.chainId,c=o.errorMessage,d=o.isLoading,f=o.lifecycleStatus,S=o.onSubmit,p=o.receipt,w=o.transactions,L=o.transactionCount,y=o.transactionHash,x=o.transactionId,W=kt(),M=W.address,_=i??Lt(),tt=f.statusName==="transactionLegacyExecuted"&&L!==((z=(H=f==null?void 0:f.statusData)==null?void 0:H.transactionHashList)==null?void 0:z.length),R=f.statusName==="buildingTransaction"||f.statusName==="transactionPending"||tt||d,B=!p&&(R||(!w||!M)||(!!x||!!y)||e),v=hs({errorMessage:c,hasReceipt:!!p,isInProgress:R,transactionHash:y,transactionId:x}),$=u.useMemo(()=>{const g=(n==null?void 0:n.text)??"View transaction",T=(a==null?void 0:a.text)??"Try again",Z=(r==null?void 0:r.text)??l.jsx(Dt,{});return{successText:g,errorText:T,pendingContent:Z}},[a,r,n]),D=$.errorText,G=$.successText,O=$.pendingContent,h=u.useCallback(()=>{if(p&&x&&y&&i&&M){const T=new URL("https://wallet.coinbase.com/assets/transactions");return T.searchParams.set("contentParams[txHash]",y),T.searchParams.set("contentParams[chainId]",JSON.stringify(i)),T.searchParams.set("contentParams[fromAddress]",M),window.open(T,"_blank","noopener,noreferrer")}const g=At(_);return window.open(`${g}/tx/${y}`,"_blank","noopener,noreferrer")},[M,i,p,x,y,_]),b=u.useCallback(()=>{var g;if(n!=null&&n.onClick&&p)return(g=n==null?void 0:n.onClick)==null?void 0:g.call(n,p);h()},[h,n,p]),U=u.useCallback(()=>{var g;return a!=null&&a.onClick?(g=a==null?void 0:a.onClick)==null?void 0:g.call(a):S()},[a,S]),q=u.useMemo(()=>p?G:c?D:v?O:s,[v,c,D,s,O,p,G]),J=u.useCallback(()=>{p?b():c?U():S()},[c,U,S,p,b]);return l.jsx("button",{className:C(jt.primary,Qt.radius,"w-full rounded-xl","px-4 py-3 font-medium leading-6",B&&jt.disabled,I.headline,E.inverse,t),onClick:J,type:"button",disabled:B,"data-testid":"ockTransactionButton_Button",children:q})}function Os(){const t=K(),e=t.chainId,s=t.errorMessage,a=t.onSubmit,n=t.transactionHash,r=t.transactionId,o=e??Lt(),i=ps(),c=i.showCallsStatus;return u.useMemo(()=>{const d=At(o);let f=null;return n&&(f=l.jsx("a",{href:`${d}/tx/${n}`,target:"_blank",rel:"noreferrer",children:l.jsx("span",{className:C(I.label1,E.primary),children:"View transaction"})})),r&&(f=l.jsx("button",{onClick:()=>c({id:r}),type:"button",children:l.jsx("span",{className:C(I.label1,E.primary),children:"View transaction"})})),s&&(f=l.jsx("button",{type:"button",onClick:a,children:l.jsx("span",{className:C(I.label1,E.primary),children:"Try again"})})),{actionElement:f}},[o,s,a,c,n,r])}function Fs({className:t}){const e=Os(),s=e.actionElement;return l.jsx("div",{className:C(I.label1,"text-nowrap",t),children:s})}function Vs({className:t}){const e=K(),s=e.errorMessage,a=e.isLoading,n=e.receipt,r=e.transactionHash,o=e.transactionId,i=a||!!o||!!r,c=u.useMemo(()=>n?l.jsx(cs,{}):s?l.jsx(us,{}):i?l.jsx(Dt,{className:"px-1.5 py-1.5"}):null,[i,s,n]);return c?l.jsx("div",{className:C(I.label2,t),children:c}):null}function Ks(){const t=K(),e=t.errorMessage,s=t.isLoading,a=t.lifecycleStatus,n=t.receipt,r=t.transactionHash,o=t.transactionId,i=s||!!o||!!r,c=a.statusName==="buildingTransaction";return u.useMemo(()=>{let d="",f=E.foregroundMuted;return c&&(d="Building transaction"),i&&(d="Transaction in progress"),n&&(d="Successful"),e&&(d="Something went wrong",f=E.error),{label:d,labelClassName:f}},[e,c,i,n])}function Ws({className:t}){const e=Ks(),s=e.label;return l.jsx("div",{className:C(I.label1,"text-nowrap",t),children:l.jsx("p",{className:E.foreground,children:s})})}function Bs({children:t,className:e,durationMs:s=5e3,position:a="bottom-center"}){const n=K(),r=n.errorMessage,o=n.isLoading,i=n.isToastVisible,c=n.receipt,d=n.setIsToastVisible,f=n.transactionHash,S=n.transactionId,p=u.useCallback(()=>{d(!1)},[d]);return!i||!c&&!o&&!f&&!r&&!S?null:l.jsx(ls,{position:a,className:e,durationMs:s,isVisible:i,onClose:p,startTimeout:!!c||!!r,children:t??l.jsxs(l.Fragment,{children:[l.jsx(Vs,{}),l.jsx(Ws,{}),l.jsx(Fs,{})]})})}function oe({calls:t,capabilities:e,chainId:s,className:a,children:n,contracts:r,disabled:o=!1,isSponsored:i,onError:c,onStatus:d,onSuccess:f,resetAfter:S}){const p=Jt(),w=zt(),L=Mt(),y=L.chain;if(!p)return l.jsx("div",{className:C(w,"flex w-full flex-col gap-2",a)});const x=s||y.id;return l.jsx(vs,{calls:t,capabilities:e,chainId:x,contracts:r,isSponsored:i,onError:c,onStatus:d,onSuccess:f,resetAfter:S,children:l.jsx("div",{className:C(w,"flex w-full flex-col gap-2",a),children:n??l.jsxs(l.Fragment,{children:[l.jsx($s,{disabled:o}),l.jsx(Bs,{})]})})})}export{oe as T,$s as a,ps as b,K as u};

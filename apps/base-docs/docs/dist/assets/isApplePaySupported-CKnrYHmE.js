import{ao as N,aS as C,S as h}from"./OnchainKitProvider-BMiQl1rP.js";import{S as A,a as D,b as O,c as $,P as M}from"./getSwapErrorCode-Rcq4QZsj.js";import{a as j,f as F,w as B}from"./useIcon-C51nxPJS.js";import{r as p}from"./index-Dlxm52NL.js";import{u as k}from"./useValue-BadCClMc.js";import{u as H}from"./useGetETHBalance-Be2rjpzo.js";import{a as E}from"./useGetTokenBalance-D84Q7gP2.js";import{b as L}from"./parseAbi-DHKPviCp.js";import{h as x}from"./waitForTransactionReceipt-DqmUmnvq.js";import{g as q}from"./getWindowDimensions-iG_J0Zn9.js";const G="cdp_getSwapQuote",W="cdp_getSwapTrade";function V(t,e){return z(t)||J(t,e)||Q(t,e)||K()}function K(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Q(t,e){if(t){if(typeof t=="string")return T(t,e);var r={}.toString.call(t).slice(8,-1);return r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set"?Array.from(t):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?T(t,e):void 0}}function T(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function J(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,o,a,i,s=[],c=!0,u=!1;try{if(a=(r=r.call(t)).next,e!==0)for(;!(c=(n=a.call(r)).done)&&(s.push(n.value),s.length!==e);c=!0);}catch(l){u=!0,o=l}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw o}}return s}}function z(t){if(Array.isArray(t))return t}function Y(t,e){const r=t.split("."),n=V(r,2),o=n[0],a=n[1],c=(a===void 0?"":a).padEnd(e,"0").slice(0,e);return(BigInt(o+c)*BigInt(10)**BigInt(e-c.length)).toString()}function X(t,e){return rt(t)||et(t,e)||tt(t,e)||Z()}function Z(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tt(t,e){if(t){if(typeof t=="string")return w(t,e);var r={}.toString.call(t).slice(8,-1);return r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set"?Array.from(t):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?w(t,e):void 0}}function w(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function et(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,o,a,i,s=[],c=!0,u=!1;try{if(a=(r=r.call(t)).next,e!==0)for(;!(c=(n=a.call(r)).done)&&(s.push(n.value),s.length!==e);c=!0);}catch(l){u=!0,o=l}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw o}}return s}}function rt(t){if(Array.isArray(t))return t}function nt(t,e){if(t.includes(".")){const s=t.split("."),c=X(s,2),u=c[0],f=c[1].padEnd(e,"0");return u+f}const r=BigInt(t),n=BigInt(10)**BigInt(e),o=(r/n).toString(),i=(r%n).toString().padStart(e,"0").replace(/0+$/,"");return i?`${o}.${i}`:o}function at(t,e=!0,r=18){let n;return e?n=nt(t,r):n=Y(t,r),n}function U(t){const e=t.from,r=t.to,n=t.amount,o=t.amountReference,a=t.isAmountInDecimals,i=t.fromAddress,s=o==="from"?e.decimals:r.decimals;return typeof n!="string"||n.trim()===""?{code:"INVALID_INPUT",error:"Invalid input: amount must be a non-empty string",message:""}:!Number.isInteger(s)||s<0?{code:"INVALID_INPUT",error:"Invalid input: decimals must be a non-negative integer",message:""}:/^(?:0|[1-9]\d*|\.\d+)(?:\.\d*)?$/.test(n)?{fromAddress:i,from:e.address||"ETH",to:r.address||"ETH",amount:a?n:at(n,!1,s),amountReference:o||"from"}:{code:"INVALID_INPUT",error:"Invalid input: amount must be a non-negative number string",message:""}}function S(t,e){const r=t.data,n=t.gas,o=t.to,a=t.value;return{chainId:Number(e),data:r,gas:BigInt(n),to:o,value:BigInt(a)}}function R(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),r.push.apply(r,n)}return r}function P(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?R(Object(r),!0).forEach(function(n){ot(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function ot(t,e,r){return(e=it(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function it(t){var e=st(t,"string");return typeof e=="symbol"?e:e+""}function st(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}async function Ut(t,e=N.API){var o;let n=U(P(P({},{amountReference:"from",isAmountInDecimals:!1}),t));if("error"in n)return n;if(t.useAggregator&&t.amountReference==="to")return console.error(A.UNSUPPORTED_AMOUNT_REFERENCE),{code:D,error:A.UNSUPPORTED_AMOUNT_REFERENCE,message:""};if(t.useAggregator||(n=P({v2Enabled:!0},n)),t.maxSlippage){let a=t.maxSlippage;t.useAggregator&&(a=(Number(t.maxSlippage)*10).toString()),n=P({slippagePercentage:a},n)}try{const a=await j(W,[n],e);if(a.error)return{code:O("swap",(o=a.error)==null?void 0:o.code),error:a.error.message,message:""};const i=a.result;return{approveTransaction:i.approveTx?S(i.approveTx,i.chainId):void 0,fee:i.fee,quote:i.quote,transaction:S(i.tx,i.chainId),warning:i.quote.warning}}catch{return{code:O("uncaught-swap"),error:"Something went wrong",message:""}}}function I(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),r.push.apply(r,n)}return r}function v(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?I(Object(r),!0).forEach(function(n){ct(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function ct(t,e,r){return(e=ut(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ut(t){var e=lt(t,"string");return typeof e=="symbol"?e:e+""}function lt(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}async function Ct(t,e=N.API){var o;let n=U(v(v({},{amountReference:"from",isAmountInDecimals:!1}),t));if("error"in n)return n;if(t.useAggregator&&t.amountReference==="to")return console.error(A.UNSUPPORTED_AMOUNT_REFERENCE),{code:D,error:A.UNSUPPORTED_AMOUNT_REFERENCE,message:""};if(t.useAggregator||(n=v({v2Enabled:!0},n)),t.maxSlippage){let a=t.maxSlippage;t.useAggregator&&(a=(Number(t.maxSlippage)*10).toString()),n=v({slippagePercentage:a},n)}try{const a=await j(G,[n],e);return a.error?{code:O("quote",(o=a.error)==null?void 0:o.code),error:a.error.message,message:""}:a.result}catch{return{code:O("uncaught-quote"),error:"Something went wrong",message:""}}}function $t(t,e){return(Number(t)/10**e).toString()}function Mt({accountConfig:t,lifecycleStatus:e,updateLifecycleStatus:r}){var i;const n=e.statusName==="transactionApproved"?(i=e.statusData)==null?void 0:i.callsId:void 0,o=F({id:n||"",query:{refetchInterval:s=>{var c;return((c=s.state.data)==null?void 0:c.status)==="CONFIRMED"?!1:1e3},enabled:n!==void 0}}),a=o.data;return p.useCallback(async()=>{if((a==null?void 0:a.status)==="CONFIRMED"&&(a!=null&&a.receipts)){const s=await B(t,{confirmations:1,hash:a.receipts[a.receipts.length-1].transactionHash});r({statusName:"success",statusData:{transactionReceipt:s}})}},[t,a,r])}function Ft({address:t,fromToken:e,toToken:r}){const n=H(t),o=n.convertedBalance,a=n.error,i=n.response,s=E(t,e),c=s.convertedBalance,u=s.error,l=s.response,f=E(t,r),m=f.convertedBalance,y=f.error,d=f.response,g=(e==null?void 0:e.symbol)==="ETH",b=(r==null?void 0:r.symbol)==="ETH";return k({fromBalanceString:g?o:c,fromTokenBalanceError:g?a:u,fromTokenResponse:g?i:l,toBalanceString:b?o:m,toTokenBalanceError:b?a:y,toTokenResponse:b?i:d})}function kt(t){return t!==null&&typeof t=="object"&&"error"in t}async function ft({config:t,sendTransactionAsync:e,transactions:r,updateLifecycleStatus:n}){let o;for(const a of r){const i=a.transaction,s=a.transactionType;n({statusName:"transactionPending"});const c=await e(i);n({statusName:"transactionApproved",statusData:{transactionHash:c,transactionType:s}}),o=await B(t,{hash:c,confirmations:1})}o&&n({statusName:"success",statusData:{transactionReceipt:o}})}async function mt({config:t,isSponsored:e,paymaster:r,sendCallsAsync:n,sendTransactionAsync:o,updateLifecycleStatus:a,walletCapabilities:i,transactions:s}){var c;if((c=i[C.AtomicBatch])!=null&&c.supported){a({statusName:"transactionPending"});const u=await n({calls:s.map(({transaction:l})=>l),capabilities:e?{paymasterService:{url:r}}:{}});a({statusName:"transactionApproved",statusData:{callsId:u,transactionType:"Batched"}})}else await ft({config:t,sendTransactionAsync:o,transactions:s,updateLifecycleStatus:a})}async function Ht({chainId:t,config:e,isSponsored:r,paymaster:n,sendCallsAsync:o,sendTransactionAsync:a,swapTransaction:i,switchChainAsync:s,updateLifecycleStatus:c,useAggregator:u,walletCapabilities:l}){const f=i.transaction,m=i.approveTransaction,y=i.quote,d=[];if(m!=null&&m.data&&(d.push({transaction:{to:m.to,value:m.value,data:m.data},transactionType:"ERC20"}),!u)){const g=L(["function approve(address token, address spender, uint160 amount, uint48 expiration) external"]),b=x({abi:g,functionName:"approve",args:[y.from.address,$,BigInt(y.fromAmount),2e13]});d.push({transaction:{to:M,value:0n,data:b},transactionType:"Permit2"})}d.push({transaction:{to:f.to,value:f.value,data:f.data},transactionType:"Swap"}),t!==h.id&&await s({chainId:h.id}),await mt({config:e,isSponsored:r,paymaster:n,sendCallsAsync:o,sendTransactionAsync:a,transactions:d,updateLifecycleStatus:c,walletCapabilities:l})}function Lt(t,e){const r=p.useCallback(n=>{var s;if(!t.current)return;const o=!t.current.contains(n.target),a=(s=n.composedPath)==null?void 0:s.call(n);!(a==null?void 0:a.some(c=>c instanceof HTMLElement&&c.hasAttribute("data-portal-origin")))&&o&&e()},[e,t]);p.useEffect(()=>(document.addEventListener("click",r,{capture:!0}),()=>{document.removeEventListener("click",r,{capture:!0})}),[r])}const xt=t=>{const e=p.useRef(null),r=p.useCallback(o=>{e.current&&clearInterval(e.current),e.current=window.setInterval(()=>{o.closed&&(e.current&&(clearInterval(e.current),e.current=null),t==null||t())},500)},[t]),n=p.useCallback(()=>{e.current&&(clearInterval(e.current),e.current=null)},[]);return p.useEffect(()=>()=>n(),[n]),{startPopupMonitor:r,stopPopupMonitor:n}},_="https://pay.coinbase.com",pt=`${_}/buy`,dt=720,gt=460,qt="https://api.developer.coinbase.com/onramp/v1",Gt=3e3;function Wt(t,e){return e!=null&&e.includes(pt)?{height:dt,width:gt}:q(t)}function bt({onMessage:t,allowedOrigin:e=_,onValidateOrigin:r=()=>Promise.resolve(!0)}){const n=o=>{if(!yt({event:o,allowedOrigin:e}))return;const a=JSON.parse(o.data),i=a.eventName,s=a.data;i==="event"&&(async()=>await r(o.origin)&&t(s))()};return window.addEventListener("message",n),()=>{window.removeEventListener("message",n)}}function yt({event:t,allowedOrigin:e}){return!e||t.origin===e}function Vt({onEvent:t,onExit:e,onSuccess:r,host:n=_}){return bt({allowedOrigin:n,onMessage:a=>{const i=a;i.eventName==="success"&&(r==null||r(i.data)),i.eventName==="exit"&&(e==null||e(i.error)),t==null||t(i)}})}function Kt(){return/iPhone|iPad|iPod/.test(navigator.userAgent)||/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/Edg/.test(navigator.userAgent)}export{Gt as F,pt as O,Mt as a,xt as b,Ut as c,Wt as d,Kt as e,$t as f,Ct as g,Lt as h,kt as i,qt as j,Ht as p,Vt as s,Ft as u};

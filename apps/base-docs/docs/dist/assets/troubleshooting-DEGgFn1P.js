import{u as i,j as e}from"./index-Dlxm52NL.js";const t={title:"Paymaster & Bundler Troubleshooting",sidebar_label:"Troubleshooting",slug:"paymaster-bundler-troubleshooting"};function s(n){const a={a:"a",code:"code",div:"div",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",span:"span",ul:"ul",...i(),...n.components};return e.jsxs(e.Fragment,{children:[e.jsx(a.p,{children:"This tutorial explains how to debug common issues you may face when sending UserOperations."}),`
`,e.jsxs(a.h2,{id:"execution-reverted",children:["Execution reverted",e.jsx(a.a,{"aria-hidden":"true",tabIndex:"-1",href:"#execution-reverted",children:e.jsx(a.div,{"data-autolink-icon":!0})})]}),`
`,e.jsx(a.p,{children:"The UserOperation was able to make it onchain, but an error occurred in one of the smart contracts it interacted with, and thus the entire operation had to be reverted. This can be due to"}),`
`,e.jsxs(a.ul,{children:[`
`,e.jsxs(a.li,{children:["Not enough gas to pay for execution",`
`,e.jsxs(a.ul,{children:[`
`,e.jsxs(a.li,{children:["Try increasing the ",e.jsx(a.code,{children:"preVerificationGas"})," or ",e.jsx(a.code,{children:"callGasLimit"})," padding"]}),`
`]}),`
`]}),`
`,e.jsxs(a.li,{children:["An issue with the ",e.jsx(a.code,{children:"callData"})," of your UserOperations",`
`,e.jsxs(a.ul,{children:[`
`,e.jsx(a.li,{children:"This is an issue with your dapp's smart contract, which you will need to debug."}),`
`]}),`
`]}),`
`]}),`
`,e.jsxs(a.p,{children:["You can use a tool like ",e.jsx(a.a,{href:"https://dashboard.tenderly.co/",children:"Tenderly"})," to help simulate and debug the UserOperation."]}),`
`,e.jsxs(a.h3,{id:"issue-regarding-gas-estimation",children:["Issue regarding gas estimation",e.jsx(a.a,{"aria-hidden":"true",tabIndex:"-1",href:"#issue-regarding-gas-estimation",children:e.jsx(a.div,{"data-autolink-icon":!0})})]}),`
`,e.jsxs(a.p,{children:["If you think the issue may be related to gas, simulate using the Entrypoint contract, ",e.jsx(a.code,{children:"0x5ff137d4b0fdcd49dca30c7cf57e578a026d2789"}),", and pasting in your UserOperation into the ",e.jsx(a.code,{children:"tuple"})," field."]}),`
`,e.jsx(a.p,{children:"For example, your UserOperation may look something like"}),`
`,e.jsx(e.Fragment,{children:e.jsx(a.pre,{className:"shiki shiki-themes github-light github-dark",style:{backgroundColor:"#fff","--shiki-dark-bg":"#24292e",color:"#24292e","--shiki-dark":"#e1e4e8"},tabIndex:"0",children:e.jsxs(a.code,{children:[e.jsx(a.span,{className:"line",children:e.jsx(a.span,{style:{color:"#24292E","--shiki-dark":"#E1E4E8"},children:"{"})}),`
`,e.jsx(a.span,{className:"line",children:e.jsx(a.span,{style:{color:"#24292E","--shiki-dark":"#E1E4E8"},children:'  "callData": "0xb61d27f600000000000000000000000066519fcaee1ed65bc9e0acc25ccd900668d3ed490000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000443f84ac0e0000000000000000000000001e3143e0ed8c0ea51f1551b6c355e02f3e0baae0000000000000000000000000000000000000000000000000000000000000006400000000000000000000000000000000000000000000000000000000",'})}),`
`,e.jsx(a.span,{className:"line",children:e.jsx(a.span,{style:{color:"#24292E","--shiki-dark":"#E1E4E8"},children:'  "paymasterAndData": "0xc484bcd10ab8ad132843872deb1a0adc1473189c000066cd03db0000000000000098973f00000a968163f0a57b400000018633de6cf5e53752c5eac49e8f8ffb4ecd16b2afe7b4074086d6693536a9ab1f117bae0b427f83f94246c34d25add97b05e8a73859c2dceef6ee730ab2842bf31b",'})}),`
`,e.jsx(a.span,{className:"line",children:e.jsx(a.span,{style:{color:"#24292E","--shiki-dark":"#E1E4E8"},children:'  "sender": "0x1e3143E0ED8C0Ea51F1551B6c355e02f3e0bAae0",'})}),`
`,e.jsx(a.span,{className:"line",children:e.jsx(a.span,{style:{color:"#24292E","--shiki-dark":"#E1E4E8"},children:'  "initCode": "0x",'})}),`
`,e.jsx(a.span,{className:"line",children:e.jsx(a.span,{style:{color:"#24292E","--shiki-dark":"#E1E4E8"},children:'  "maxFeePerGas": "3000000000",'})}),`
`,e.jsx(a.span,{className:"line",children:e.jsx(a.span,{style:{color:"#24292E","--shiki-dark":"#E1E4E8"},children:'  "maxPriorityFeePerGas": "1000000000",'})}),`
`,e.jsx(a.span,{className:"line",children:e.jsx(a.span,{style:{color:"#24292E","--shiki-dark":"#E1E4E8"},children:'  "nonce": "31815307923431762811356398485504",'})}),`
`,e.jsx(a.span,{className:"line",children:e.jsx(a.span,{style:{color:"#24292E","--shiki-dark":"#E1E4E8"},children:'  "signature": "0x0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000041ca7a742cff01aa9d5e377c5a146b5d8f03a4e44bd1817b1899bf7e0ff6885ed63294c69f017fe47f385c046055cc687e503bba08513ff52fbf21dcd8019c1f1d1b00000000000000000000000000000000000000000000000000000000000000",'})}),`
`,e.jsx(a.span,{className:"line",children:e.jsx(a.span,{style:{color:"#24292E","--shiki-dark":"#E1E4E8"},children:'  "callGasLimit": "257565",'})}),`
`,e.jsx(a.span,{className:"line",children:e.jsx(a.span,{style:{color:"#24292E","--shiki-dark":"#E1E4E8"},children:'  "preVerificationGas": "96024",'})}),`
`,e.jsx(a.span,{className:"line",children:e.jsx(a.span,{style:{color:"#24292E","--shiki-dark":"#E1E4E8"},children:'  "verificationGasLimit": "87888"'})}),`
`,e.jsx(a.span,{className:"line",children:e.jsx(a.span,{style:{color:"#24292E","--shiki-dark":"#E1E4E8"},children:"}"})})]})})}),`
`,e.jsxs(a.p,{children:["You can use the ",e.jsx(a.code,{children:"simulateHandleOp"})," function and pass that UserOperation in the ",e.jsx(a.code,{children:"op"}),` field (don't forget to add array brackets around it, because technically it handles a "bundle" of UserOperations).`]}),`
`,e.jsxs("details",{children:[e.jsx("summary",{children:e.jsx("b",{children:"Expand for images and click to enlarge"})}),e.jsxs("div",{children:[e.jsx("figcaption",{children:e.jsx("i",{children:"Tenderly - Entrypoint"})})," ",e.jsx("img",{src:"/images/paymaster/pb-paymaster-tenderly-entrypoint.png",width:"700",alt:"Tenderly Entrypoint"})]})]}),`
`,e.jsxs(a.h3,{id:"execution-reverted-with-data",children:["Execution reverted with data",e.jsx(a.a,{"aria-hidden":"true",tabIndex:"-1",href:"#execution-reverted-with-data",children:e.jsx(a.div,{"data-autolink-icon":!0})})]}),`
`,e.jsx(a.p,{children:"Error may look something like this"}),`
`,e.jsx(e.Fragment,{children:e.jsx(a.pre,{className:"shiki shiki-themes github-light github-dark",style:{backgroundColor:"#fff","--shiki-dark-bg":"#24292e",color:"#24292e","--shiki-dark":"#e1e4e8"},tabIndex:"0",children:e.jsxs(a.code,{children:[e.jsx(a.span,{className:"line",children:e.jsx(a.span,{style:{color:"#24292E","--shiki-dark":"#E1E4E8"},children:"cause: {"})}),`
`,e.jsx(a.span,{className:"line",children:e.jsx(a.span,{style:{color:"#24292E","--shiki-dark":"#E1E4E8"},children:'  "code": -32004,'})}),`
`,e.jsx(a.span,{className:"line",children:e.jsx(a.span,{style:{color:"#24292E","--shiki-dark":"#E1E4E8"},children:'  "message": " - execution reverted with data",'})}),`
`,e.jsx(a.span,{className:"line",children:e.jsx(a.span,{style:{color:"#24292E","--shiki-dark":"#E1E4E8"},children:'  "data": "0xed6c3dec00000000000000000000000036e53f56454e1206f775dafe2b33c1b737c43632"'})}),`
`,e.jsx(a.span,{className:"line",children:e.jsx(a.span,{style:{color:"#24292E","--shiki-dark":"#E1E4E8"},children:"}"})})]})})}),`
`,e.jsxs(a.p,{children:["You can use a tool like ",e.jsx(a.a,{href:"https://bia.is/tools/abi-decoder/",children:"https://bia.is/tools/abi-decoder/"})," to upload your ABI, enter the data in, and decode the error message. Try using the ABI of every smart contract your dapp could be interacting with."]}),`
`,e.jsxs(a.h3,{id:"execution-reverted-for-an-unknown-reason",children:["Execution reverted for an unknown reason",e.jsx(a.a,{"aria-hidden":"true",tabIndex:"-1",href:"#execution-reverted-for-an-unknown-reason",children:e.jsx(a.div,{"data-autolink-icon":!0})})]}),`
`,e.jsxs(a.p,{children:["Similar to above, except your contract is reverting without any error codes. Try reviewing your smart contract's code, your ",e.jsx(a.code,{children:"callData"}),", and using ",e.jsx(a.a,{href:"https://dashboard.tenderly.co/",children:"Tenderly"})," to debug. It may help to have your ",e.jsx(a.a,{href:"https://book.getfoundry.sh/reference/forge/forge-verify-contract",children:"contract verified."})]}),`
`,e.jsx(a.p,{children:"The example below shows you how to debug your own smart contract."}),`
`,e.jsxs(a.ul,{children:[`
`,e.jsxs(a.li,{children:[e.jsx(a.code,{children:"Insert any address"})," - Enter your smart contract's address here"]}),`
`,e.jsxs(a.li,{children:[e.jsx(a.code,{children:"Enter raw input data"})," - Enter the ",e.jsx(a.code,{children:"callData"})," of your contract's function (right after ",e.jsx(a.code,{children:"callData = encodeFunctionData()"}),")"]}),`
`]}),`
`,e.jsxs("details",{children:[e.jsx("summary",{children:e.jsx("b",{children:"Expand for images and click to enlarge"})}),e.jsxs("div",{children:[e.jsx("figcaption",{children:e.jsx("i",{children:"Tenderly - Contract Debug"})})," ",e.jsx("img",{src:"/images/paymaster/pb-paymaster-tenderly-dev-debug.png",width:"700",alt:"Tenderly Debug"})]})]}),`
`,e.jsxs(a.h2,{id:"invalid-chain-id",children:["Invalid chain id",e.jsx(a.a,{"aria-hidden":"true",tabIndex:"-1",href:"#invalid-chain-id",children:e.jsx(a.div,{"data-autolink-icon":!0})})]}),`
`,e.jsx(a.p,{children:"You might be using the mainnet RPC url instead of the testnet RPC url (or vice versa). Make sure you select the right network in the CDP portal"}),`
`,e.jsxs("details",{children:[e.jsx("summary",{children:e.jsx("b",{children:"Expand for images and click to enlarge"})}),e.jsxs("div",{children:[e.jsx("figcaption",{children:e.jsx("i",{children:"Paymaster chain"})})," ",e.jsx("img",{src:"/images/paymaster/pb-paymaster-chainid.png",width:"700",alt:"Paymaster Chain ID"})]})]}),`
`,e.jsxs(a.h2,{id:"invalid-useroperation-signature-or-paymaster-signature",children:["Invalid UserOperation signature or paymaster signature",e.jsx(a.a,{"aria-hidden":"true",tabIndex:"-1",href:"#invalid-useroperation-signature-or-paymaster-signature",children:e.jsx(a.div,{"data-autolink-icon":!0})})]}),`
`,e.jsx(e.Fragment,{children:e.jsx(a.pre,{className:"shiki shiki-themes github-light github-dark",style:{backgroundColor:"#fff","--shiki-dark-bg":"#24292e",color:"#24292e","--shiki-dark":"#e1e4e8"},tabIndex:"0",children:e.jsx(a.code,{children:e.jsx(a.span,{className:"line",children:e.jsx(a.span,{style:{color:"#24292E","--shiki-dark":"#E1E4E8"},children:"UserOperation rejected because account signature check failed (or paymaster signature, if the paymaster uses its data as signature)."})})})})}),`
`,e.jsxs(a.p,{children:["This likely means that you updated the UserOperation after getting a signature from our Paymaster service. Our Paymaster signs the UserOperation with the UserOperation itself, so make sure you're not making any changes to the UserOperation after it's already been signed by our Paymaster ",e.jsx(a.code,{children:"paymasterClient.getPaymasterData()"}),". If you need to adjust things like ",e.jsx(a.code,{children:"callData"}),", ",e.jsx(a.code,{children:"preVerificationGas"}),", or ",e.jsx(a.code,{children:"callGasLimit"}),", you will need to receive a new signature from our Paymaster. Also if you're handling multiple UserOperation, make sure the paymaster signature matches the right UserOperation."]})]})}function d(n={}){const{wrapper:a}={...i(),...n.components};return a?e.jsx(a,{...n,children:e.jsx(s,{...n})}):s(n)}export{d as default,t as frontmatter};
